@using HSMServer.Model.AccessKeysViewModels
@using HSMServer.Constants
@using HSMServer.Controllers

@model List<AccessKeyViewModel>


<script>
    var getAvailableAccessKeys = "@Html.Raw(Url.Action(nameof(AccessKeysController.AvailableAccessKeys), ViewConstants.AccessKeysController))";
</script>

<script src="~/js/clipboard.js/clipboard.min.js"></script>


<div class="container">
    <div class="row justify-content-center">
        <table class="table">
            <tr>
                <th>
                    Product<br />
                    (
                    <input class="form-check-input" type="checkbox" value="" onchange="allProductsChanged()" id="allProducts">
                    <label class="form-check-label" for="allProducts">
                        node)
                    </label>
                </th>
                <th>Key</th>
                <th></th>
                <th>Display name</th>
                <th>Permissions</th>
                <th>Expiration</th>
                <th>Author</th>
                <th>State</th>
                <th></th>
            </tr>
            <tbody id="accessKeysTable">
                @await Html.PartialAsync("_AllAccessKeys", Model)
            </tbody>
        </table>
    </div>
</div>

@await Html.PartialAsync("_AccessKeysModal")


<script>
    var clipboard = new ClipboardJS('[id^="copy_"]');

    function allProductsChanged() {
        var element = document.getElementById('allProducts');

        $.ajax({
            type: 'GET',
            url: getAvailableAccessKeys + "?AllProducts=" + element.checked,
            cache: false,
            async: true,
            success: function (viewData) {
                $('#accessKeysTable').html(viewData);
            }
        });
    }

    $('#accessKeys_modal').on('hidden.bs.modal', function (e) {
        allProductsChanged();
    });
</script>
