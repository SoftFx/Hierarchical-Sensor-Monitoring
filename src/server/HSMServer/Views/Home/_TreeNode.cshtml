@using HSMServer.Constants
@using HSMServer.HtmlHelpers

@model HSMServer.Model.TreeViewModels.ProductNodeViewModel

<li id='@Model.EncodedId' title='@Model.Name &#013;@Model.UpdateTime.ToString(ViewConstants.NodeUpdateTimeFormat)'
    data-jstree='{"icon" : "fas fa-circle @ViewHelper.GetStatusHeaderColorClass(Model.Status)", "time" : "@Model.UpdateTime.ToString(ViewConstants.NodeUpdateTimeFormat)"}'>
    <span>@Model.GetShortName(Model.Name) (@Model.Count sensors)</span>
    @if (Model.IsNotificationsEnabled)
    {
        <span>
            <i id="@(Model.EncodedId)_notifications" class="fab fa-telegram fa-xs"></i>
            <input id='@(Model.EncodedId)_partialNotifications' value='@(Model.IsNotificationsPartiallyEnabled.ToString())' style='display: none' />
        </span>
    }

    @if (Model.Nodes != null)
        @foreach (var (_, child) in Model.Nodes)
        {
            @if (child.Count != 0)
            {
                <ul>@await Html.PartialAsync("_TreeNode", child)</ul>
            }
        }

    @if (Model.VisibleSensors != null && Model.VisibleSensors.Count != 0)
    {
        <ul>
            @foreach (var sensor in Model.VisibleSensors)
            {
                <li id='@sensor.EncodedId' title='@sensor.Name &#013;@sensor.UpdateTime.ToString(ViewConstants.NodeUpdateTimeFormat)'
                    data-jstree='{"icon" : "fas fa-circle @ViewHelper.GetStatusHeaderColorClass(sensor.Status)", "time" : "@sensor.UpdateTime.ToString(ViewConstants.NodeUpdateTimeFormat)"}'>
                    <span>@Model.GetShortName(sensor.Name)</span>
                    @if (sensor.IsNotificationsEnabled)
                    {
                        <span>
                            <i id="@(sensor.EncodedId)_notifications" class="fab fa-telegram fa-xs mb-1"></i>
                        </span>
                    }
                </li>
            }
        </ul>
    }
</li>
