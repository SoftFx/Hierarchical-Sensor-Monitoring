@using HSMServer.Model.Controls
@using HSMServer.Notifications
@using HSMServer.Extensions
@using System
@using System.Collections.Generic

@model DefaultChatViewModel

@inject ITelegramChatsManager ChatsManager

@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers

@{
    var emptyValue = DefaultChatViewModel.EmptyValue;
    var displayName = Model.GetCurrentDisplayValue(ChatsManager.GetValues(), out var allChats);
    var parentName = Model.GetParentDisplayValue(allChats);
}


<style>
    /* For null option in selectpicker */
    .bootstrap-select.default-chat > .dropdown-toggle.bs-placeholder, .bootstrap-select.default-chat > .dropdown-toggle.bs-placeholder:hover, .bootstrap-select.default-chat > .dropdown-toggle.bs-placeholder:focus, .bootstrap-select.default-chat > .dropdown-toggle.bs-placeholder:active {
        color: black;
    }
</style>


<span class="@(Model.IsModify ? "col-2" : "meta-info-label")">Default telegram chat</span>

<span id="labelDefaultChat" class="@(Model.IsModify ? "d-none" : "meta-info-value")">@displayName</span>
<div id="defaultChatControl" class="@(Model.IsModify ? "col-auto ms-1" : "d-none meta-info-interval")">
    <select asp-for="SelectedChat" class="default-chat selectpicker">
        @if (Model.HasParent)
        {
            <option value="" selected="@Model.IsFromParent">@parentName</option>
        }

        <option value="@emptyValue.Id" selected="@Model.IsSelectedChat(emptyValue.Id)">@emptyValue.Name</option>

        <option data-divider="true"></option>
        <option disabled>Groups</option>
        @foreach (var chat in allChats.GetGroups())
        {
            <option value="@chat.Id" selected="@Model.IsSelectedChat(chat.Id)">@chat.Name</option>
        }

        <option data-divider="true"></option>
        <option disabled>Users</option>
        @foreach (var chat in allChats.GetPrivates())
        {
            <option value="@chat.Id" selected="@Model.IsSelectedChat(chat.Id)">@chat.Name</option>
        }
    </select>
</div>

<i class='fas fa-question-circle mx-2' title='Telegram chat that will be default for new sensors.'></i>


<script>
     $(document).ready(function () {
       $("select[name='DefaultChats.SelectedChat']").selectpicker();
     });
</script>
