<?xml version="1.0" encoding="utf-8" ?>
<nlog xmlns="http://www.nlog-project.org/schemas/NLog.xsd"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      autoReload="true"
      internalLogLevel="Info"
      internalLogFile="c:\temp\internal-nlog.txt">

	<!-- 
    Enable ASP.NET Core layout renderers for NLog.
    Required for ASP.NET Core specific logging features.
  -->
	<extensions>
		<add assembly="NLog.Web.AspNetCore"/>
	</extensions>

	<!-- 
    Define logging targets (output destinations).
    All targets are configured for asynchronous writing.
  -->
	<targets async="true">
		<!-- 
      Error log file target:
      - Logs only error level messages
      - Daily archiving with ZIP compression
      - Keeps 60 days of archives
      - Includes thread ID, event ID, log level, logger name, message and exception details
    -->
		<target xsi:type="File"
			name="errorfile"
			fileName="${basedir}/Logs/HSM-error-log-${shortdate}.txt"
			layout="${longdate}|${pad:padding=3:fixedLength=true:inner=${threadid}}|${event-properties:item=EventId_Id}|${uppercase:${level}}|${logger}| ${message} ${exception:format=tostring}|"
			archiveFileName="${basedir}/Logs/Archives/HSM-error-log-{#}.zip"
			archiveNumbering="Date"
			archiveEvery="Day"
			archiveDateFormat="yyyy-MM-dd"
			maxArchiveFiles="60"
			enableArchiveFileCompression="true"
			enableFileDelete="true"/>

		<!-- 
      General log file target:
      - Logs all messages (Trace level and above)
      - Archives when file reaches 100MB or daily
      - Keeps 60 archive files
      - Includes timestamp, thread ID, log level, logger name, message and exception
    -->
		<target xsi:type="File"
			name="allfile"
			fileName="${basedir}/Logs/HSM-all-log-${shortdate}.txt"
			layout="${longdate}|${pad:padding=3:fixedLength=true:inner=${threadid}}|${uppercase:${level}}|${logger}| ${message} ${exception:format=tostring}"
			archiveFileName="${basedir}/Logs/Archives/HSM-all-log-${shortdate}_{#}.zip"
			archiveNumbering="Sequence"
			archiveEvery="Day"
			archiveAboveSize="104857600"
			maxArchiveFiles="60"
			enableArchiveFileCompression="true"
			enableFileDelete="true"
         />

		<!-- 
      ASP.NET specific log file target:
      - Logs ASP.NET related messages (Trace level and above)
      - Includes additional ASP.NET context info (URL, MVC action)
      - Same archiving strategy as general log
    -->
		<target xsi:type="File"
		name="aspfile"
		fileName="${basedir}/Logs/ASP-all-log-${shortdate}.txt"
		layout="${longdate}|${pad:padding=3:fixedLength=true:inner=${threadid}}|${event-properties:item=EventId_Id}|${uppercase:${level}}|${logger}| ${message} ${exception:format=tostring}|url: ${aspnet-request-url}|action: ${aspnet-mvc-action}"
		archiveFileName="${basedir}/Logs/Archives/ASP-all-log-${shortdate}_{#}.zip"
		archiveNumbering="Sequence"
		archiveEvery="Day"
		archiveAboveSize="104857600"
		maxArchiveFiles="60"
		enableArchiveFileCompression="true"
		enableFileDelete="true"
    />
	</targets>

	<!-- 
    Define logging rules that route messages to appropriate targets.
    Filters can be applied based on build configuration (Debug/Release).
  -->
	<rules>
		<!-- Route all errors to errorfile target -->
		<logger name="*" minlevel="Error" writeTo="errorfile"/>

		<!-- 
      Route ASP.NET framework logs to aspfile target in Debug configuration only.
      Includes Trace level and above messages.
    -->
		<logger name="Microsoft.AspNetCore*" minlevel="Trace" writeTo="aspfile">
			<filters defaultAction="LogFinal">
				<when condition="'${buildConfiguration}' == 'Release'" action="IgnoreFinal" />
			</filters>
		</logger>

		<!-- 
      Route all Trace and Debug messages to allfile target in Debug configuration only.
      These messages will be ignored in Release builds.
    -->
		<logger name="*" minlevel="Trace" maxlevel="Debug" writeTo="allfile">
			<filters defaultAction="Log">
				<when condition="'${buildConfiguration}' == 'Release'" action="IgnoreFinal" />
			</filters>
		</logger>

		<!-- 
      Route all Info level messages to allfile target.
      (Currently no filters applied to Info messages)
    -->
		<logger name="*" minlevel="Info" maxlevel="Info" writeTo="allfile"/>

		<!-- Route all Warning messages to allfile target -->
		<logger name="*" minlevel="Warn" writeTo="allfile"/>
	</rules>
</nlog>